            const ws = new WebSocket('wss://alfursantracking.com:2053');
          ws.onopen = () => {
            Object.keys(carMap).forEach((imei) => {
              ws.send(JSON.stringify({
                type: 'subscribe',
                imei
              }));
            });
          };
      
      
            
            
            ws.onmessage = (event) => {
            const data = JSON.parse(event.data);

            // console.log('event onmessage ', data);


            // console.log('data ', data);


            if (data.type === 'replay' && data.data.imei) {
              // console.log('onmessage' , data ) ;
              // sendCommand(data.data.imei)
            }

            if ('data' in data && data.type === 'command_response') {
              const response_command = res = data.data;
              if ('position' in response_command) {
                const {
                  position
                } = response_command;
                if (position?.lon && position?.lat) {
                  moveCarByIMEI(data.data.imei, [position.lon, position.lat], {
                    speed: position.speed,
                    lastOnline: position.datetime
                  });
                }
              }
            }


            if ('data' in data && data.type === 'heartbeat') {
              const {
                heartbeat
              } = data.data;
              moveCarByIMEI(data.imei, null, {
                voltage: heartbeat.externalVoltage
              });
            }


            if (data.type === 'gps' && data.data?.imei) {
              if (data.data.speed > 5) {
                // $('.span' + data.data.imei).css('background', '#0bd32d');
                $('.span' + data.data.imei).removeClass('stopped').addClass('running');
                $('.statusaddressDev' + data.data.imei).text(' ğŸš™ Ù…ØªØ­Ø±Ùƒ').css('color', '#0bd32d');
                $('.carImage' + data.data.imei).attr('src', imagePathGreen);
              } else {
                // $('.span' + data.data.imei).css('background', '#cb0202');
                $('.statusaddressDev' + data.data.imei).text(' â›” Ù…ØªÙˆÙ‚Ù').css('color', '#cb0202');
                $('.span' + data.data.imei).removeClass('running').addClass('stopped');
                $('.carImage' + data.data.imei).attr('src', imagePathRed);
              }


              const gps = data.data.gps;
              // console.log('gps' , gps )
              if (gps?.longitude && gps?.latitude) {
                moveCarByIMEI(data.data.imei, [gps.longitude, gps.latitude], {
                  speed: data.data.speed,
                  accOn: data.data.statusDecoded?.accOn,
                  gpsPositioned: data.data.statusDecoded?.gpsPositioned,
                  direction: data.data.direction // ğŸ‘ˆ Ø£Ø¶Ù Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ù‡Ù†Ø§
                });
              }
            }

            if (data.type === 'multi_gps' && data.data?.imei && Array.isArray(data.data.records)) {
              const last = data.data.records[data.data.records.length - 1];
              if (last?.longitude && last?.latitude) {
                moveCarByIMEI(data.data.imei, [last.longitude, last.latitude]);
              }
            }
            ////**********

            if (data.type === 'alarm' && data.data?.imei) {

              console.log('alarmTextAr ', data.data.alarmTextAr);
              console.log('speed ', data.data.speed);
              console.log('data ', data);


              const {
                gps,
                speed,
                courseStatus,
                alarmType,
                alarmText,
                alarmTextAr,
                statusDecoded
              } = data.data;
              const imei = data.data.imei;
              const car = carMap[imei]?.car;
              if (gps?.longitude && gps?.latitude) {
                moveCarByIMEI(imei, [gps.longitude, gps.latitude], {
                  speed,
                  alarmType,
                  alarmText,
                  alarmTextAr,
                  ...statusDecoded
                });
              }

              /*  // ÙƒØªØ§Ø¨Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø¯Ø§Ø®Ù„ LogDive
                                        const logDiv = document.getElementById('LogDive');
                                        const div = document.createElement('div');
                                        div.style = 'margin: 5px; padding: 5px; border-bottom: 1px solid #ccc; font-size: 14px';
                                        div.innerHTML = `
    ğŸš¨ <strong>${alarmTextAr || 'ØªÙ†Ø¨ÙŠÙ‡ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</strong>
    ğŸš— Ø§Ù„Ø³ÙŠØ§Ø±Ø©: ${car?.name || '-'} (${car?.car_number || '-'})<br>
    ğŸ“¶ IMEI: ${imei}<br>
    ğŸ•’ Ø§Ù„Ø³Ø±Ø¹Ø©: ${speed} ÙƒÙ…/Ø³ØŒ ACC: ${statusDecoded?.accOn ? 'ØªØ´ØºÙŠÙ„' : 'Ø¥ÙŠÙ‚Ø§Ù'}ØŒ GPS: ${statusDecoded?.gpsPositioned ? 'Ù…Ø«Ø¨Øª' : 'ØºÙŠØ± Ù…Ø«Ø¨Øª'}<br>
  `;
                                        logDiv.prepend(div);*/


              if (gps?.longitude && gps?.latitude) {
                moveCarByIMEI(data.data.imei, [gps.longitude, gps.latitude], {
                  speed,
                  alarmType,
                  alarmText,
                  alarmTextAr,
                  ...statusDecoded
                });
              }


              const alarm = data.data;
              const type = alarm.alarmText || 'Unknown Alarm';
              const typeAr = alarm.alarmTextAr || 'Ø¥Ù†Ø°Ø§Ø± ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
              const time = alarm.date ? new Date(alarm.date).toLocaleString() : 'N/A';
              const message = `
        <b>${type}</b><br>


    ğŸ“Ÿ IMEI: ${imei}<br>
    ğŸ•’ ${time}<br>
    ğŸš— Ø§Ù„Ø³Ø±Ø¹Ø©: ${speed} ÙƒÙ…/Ø³<br>
    ğŸ”§ Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ù‡Ø§Ø²:<br>
    - ACC: ${alarm.statusDecoded?.accOn ? 'ØªØ´ØºÙŠÙ„' : 'Ø¥ÙŠÙ‚Ø§Ù'}<br>
    - Ø§Ù„Ø­Ù…Ø§ÙŠØ©: ${alarm.statusDecoded?.defense ? 'Ù…ÙØ¹Ù„Ø©' : 'ØºÙŠØ± Ù…ÙØ¹Ù„Ø©'}<br>


  `;

              // - GPS: ${correctedGpsPositioned ? 'Ù…Ø«Ø¨Øª' : 'ØºÙŠØ± Ù…Ø«Ø¨Øª'}<br>
              //   ${correctedOilCut ? 'Ù…Ù‚Ø·ÙˆØ¹' : 'Ù…ØªØµÙ„'}<br>
              toastr['error'](
                message,
                `ğŸš¨ ${typeAr}`, {
                  closeButton: true,
                  tapToDismiss: false,
                  rtl: true,
                  timeOut: 10000,
                  extendedTimeOut: 2000
                }
              );
            }


            ////**********


            /*

                if (data.type === 'alarm' && data.data?.imei) {
                  const { gps, speed, courseStatus, alarmType, alarmText, alarmTextAr, statusDecoded } = data.data;
                  if (gps?.longitude && gps?.latitude) {
                    moveCarByIMEI(data.data.imei, [gps.longitude, gps.latitude], {
                      speed,
                      alarmType,
                      alarmText,
                      alarmTextAr,
                      ...statusDecoded
                    });
                  }
                }

                */


          };